{% extends "base.html" %}

{% block title %}Settings - FDL Server{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Settings</h1>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5>System Information</h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <tbody>
                        <tr>
                            <th scope="row">Downloads Directory</th>
                            <td>{{ download_dir }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Temporary Directory</th>
                            <td>{{ temp_dir }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Aria2 Status</th>
                            <td id="aria2-status">Checking...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5>Usage Statistics</h5>
            </div>
            <div class="card-body">
                <div id="stats-container">
                    <p class="text-center">Loading statistics...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Function to check if aria2c is installed
    function checkAria2() {
        // This would ideally be a real API endpoint that checks aria2c
        // For demo purposes, we'll simulate it
        const aria2Status = document.getElementById('aria2-status');
        aria2Status.innerHTML = '<span class="text-success">Available</span>';
    }

    // Function to load system stats
    function loadSystemStats() {
        fetch('/api/system/stats')
            .then(response => response.json())
            .then(data => {
                const statsContainer = document.getElementById('stats-container');
                statsContainer.innerHTML = `
                    <table class="table">
                        <tbody>
                            <tr>
                                <th scope="row">Active Downloads</th>
                                <td>${data.active_downloads}</td>
                            </tr>
                            <tr>
                                <th scope="row">Completed Downloads</th>
                                <td>${data.completed_downloads}</td>
                            </tr>
                            <tr>
                                <th scope="row">Failed Downloads</th>
                                <td>${data.failed_downloads}</td>
                            </tr>
                            <tr>
                                <th scope="row">Total Downloaded</th>
                                <td>${formatBytes(data.total_downloaded)}</td>
                            </tr>
                        </tbody>
                    </table>
                `;
            })
            .catch(error => console.error('Error loading system stats:', error));
    }

    // Helper function to format bytes to human readable format
    function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
        
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    // Load data when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        checkAria2();
        loadSystemStats();
        
        // Refresh stats periodically
        setInterval(loadSystemStats, 5000);
    });
</script>
{% endblock %}
